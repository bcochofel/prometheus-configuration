groups:
# Node exporter rules for load
- name: Node Exporter Load rules
  rules:
    ### LOAD alerts ###
    
    # Load warning value
    - alert: Load-WarnUsage
      expr: >
        avg by (instance, host) (
          (node_load5 / (count without (cpu, mode) (node_cpu_seconds_total{mode="idle"}))) > 4
        )
      for: 15m
      labels:
        severity: warning
        team: devops
      annotations:
        title: Load average usage warning.
        summary: Load average usage warning.
        runbook: 'http://runbooks.example.com/node_exporter_alerts.md'
        graph: 'http://grafana.example.com'
        description: |
          Load average is above 4 for the past 15m (host {{ if $labels.host }}{{ $labels.host }}{{ else }}{{ $labels.instance }}{{ end }}).
          Current value is {{ printf "%.2f" $value }}.

    # Load high value
    - alert: Load-HighUsage
      expr: >
        avg by (instance, host) (
          (node_load5 / (count without (cpu, mode) (node_cpu_seconds_total{mode="idle"}))) > 7
        )
      for: 15m
      labels:
        severity: warning
        team: devops
      annotations:
        title: Load average usage is high.
        summary: Load average usage is high.
        runbook: 'http://runbooks.example.com/node_exporter_alerts.md'
        graph: 'http://grafana.example.com'
        description: |
          Load average is above 7 for the past 15m (host {{ if $labels.host }}{{ $labels.host }}{{ else }}{{ $labels.instance }}{{ end }}).
          Current value is {{ printf "%.2f" $value }}.
